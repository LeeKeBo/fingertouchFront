(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-36e175d0"],{"071b":function(t,e,i){"use strict";var a=i("6cb5"),s=i.n(a);s.a},"0b07":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",[i("el-breadcrumb",{attrs:{separator:"/"}},[i("el-breadcrumb-item",[i("i",{staticClass:"el-icon-microphone"}),t._v(" 资源\n            ")]),i("el-breadcrumb-item",[t._v("\n                资源管理\n            ")])],1)],1),i("div",{staticClass:"container"},[i("el-table",{staticStyle:{"text-align":"center"},attrs:{data:t.tempTable,border:"",stripe:""}},[i("el-table-column",{attrs:{prop:"name",width:"180",label:"书籍名"}}),i("el-table-column",{attrs:{prop:"author",label:"作者"}}),i("el-table-column",{attrs:{prop:"isbn",label:"isbn"}}),i("el-table-column",{attrs:{prop:"publishing",label:"出版社"}}),i("el-table-column",{attrs:{prop:"pages",label:"页数"}}),i("el-table-column",{attrs:{prop:"describe",label:"简介"}}),i("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(i){return t.handleEdit(e.$index,e.row)}}},[t._v("区域划分\n                    ")]),i("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(i){return t.handleUpload(e.$index,e.row)}}},[t._v("上传音频\n                    ")])]}}])})],1),i("div",{attrs:{id:"pagination"}},[i("el-pagination",{attrs:{"current-page":t.currentTablePage,total:t.totalSize,layout:"total , ->, prev, pager, next, jumper"},on:{"current-change":t.handleCurrentChange}})],1)],1),i("el-dialog",{attrs:{id:"divDialog",fullscreen:!0,title:"区域划分",visible:t.editVisible,"before-close":t.areaDivClose},on:{"update:visible":function(e){t.editVisible=e}}},[i("div",{attrs:{id:"main"}},[i("div",{style:{width:t.sidebarWidthLeft+"px"},attrs:{id:"leftSidebar"}},[i("div",{staticStyle:{height:"100%","margin-top":"0"},style:{width:t.sidebarWidthLeft+"px"},attrs:{id:"images"}},t._l(t.imgList,(function(e,a){return i("div",{staticClass:"sideImageContainer"},[i("el-image",{staticStyle:{"margin-right":"20px"},style:a==t.currentPage?"border:3px solid #96c2f1;":"border: 1px solid black;",attrs:{src:e.src},on:{click:function(e){return t.clickImage(a)}}}),i("span",{staticStyle:{"margin-right":"30px"}},[t._v(t._s(a+1))])],1)})),0)]),i("div",{style:{backgroundImage:"url("+this.currentUrl+")",left:t.sidebarWidthLeft+25+"px"},attrs:{id:"canvasDiv",width:t.canvasWidth}},[i("canvas",{style:{cursor:this.cursor},attrs:{id:"mainCanvas",width:t.canvasWidth,height:t.canvasHeight},on:{mousedown:t.canvasDown,mouseup:t.canvasUp,mousemove:t.canvasMove}})]),i("div",{style:{width:t.sidebarWidthRight+"px",left:t.sidebarWidthLeft+t.canvasWidth+35+"px"},attrs:{id:"rightSidebar"}},[i("span",[t._v("分区列表")]),i("div",{attrs:{id:"areasContainer"}},t._l(t.drawInfo,(function(e,a){return i("div",{staticClass:"areaList",style:a==t.selectedItem?"backgroundColor:#FF722C;":"backgroundColor:#A0FFE2;"},[i("div",{staticClass:"areaIndex",style:{width:.1*t.sidebarWidthRight+"px",height:.1*t.sidebarWidthRight+"px"},on:{click:function(e){return t.selectItem(a)}}},[t._v(t._s(a+1)+"\n                        ")]),i("el-input",{staticClass:"areaName",style:{width:.6*t.sidebarWidthRight+"px"},on:{input:t.updateInput},model:{value:e.name,callback:function(i){t.$set(e,"name",i)},expression:"info.name"}}),i("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(e){return t.deleteInfo(a)}}})],1)})),0),i("div",{staticStyle:{"text-align":"center"}},[i("el-button",{attrs:{type:"primary",plain:"",title:"改变屏幕大小后，点击重新绘制"},on:{click:t.scaleDrawInfo}},[t._v("重新绘制")]),i("el-button",{attrs:{type:"primary",plain:""},on:{click:function(e){return t.submitMarks()}}},[t._v("保存分区")])],1)])])]),i("el-dialog",{attrs:{title:"上传文件",visible:t.uploadVisible,width:"50%"}},[i("el-upload",{attrs:{action:"https://jsonplaceholder.typicode.com/posts/","list-type":"picture-card",multiple:"",accept:"['jpg','png']","file-list":t.fileList}},[i("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[t._v("选取文件")])],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.uploadVisible=!1}}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:t.submitUpload}},[t._v("确 定")])],1)],1)],1)},s=[],n=(i("6b54"),i("6c7b"),i("ac6a"),i("c5f6"),{name:"resourceManage",props:{canDraw:{type:Boolean,default:!0},info:{type:Array},lineColor:{type:String,default:"#fc2052"},selectedLineColor:{type:String,default:"#ff2078"},fillColor:{type:String,default:"rgba(255,224,157,0.3)"},selectFillColor:{type:String,default:"rgba(255,18,54,0.3)"},lineWidth:{type:Number,default:1},lineType:{type:String,default:"rec"}},data:function(){return{tableData:[{name:"test",author:"test"}],idx:"",editVisible:!1,uploadVisible:!1,fileList:[],urls:["https://s2.ax1x.com/2019/11/14/MtY74J.jpg","https://s2.ax1x.com/2019/11/14/MtYTN4.jpg","https://s2.ax1x.com/2019/11/14/MtYoEF.jpg","https://s2.ax1x.com/2019/11/14/MtYq3R.jpg","https://s2.ax1x.com/2019/11/14/MtYbC9.jpg","https://s2.ax1x.com/2019/11/14/MtYLg1.jpg","https://s2.ax1x.com/2019/11/14/MtYOjx.jpg","https://s2.ax1x.com/2019/11/14/MttpUe.jpg","https://s2.ax1x.com/2019/11/14/MtYju6.jpg","https://s2.ax1x.com/2019/11/14/MtYvDK.jpg","https://s2.ax1x.com/2019/11/14/MtYxHO.jpg","https://s2.ax1x.com/2019/11/14/MttSED.jpg"],imgList:[],currentBook:"",currentUrl:"",currentPage:0,ctx:{},context:{},canvasMoveUse:!1,beginRec:{x:"",y:"",imageData:this.currentUrl},drawInfo:[],isClick:!1,selectedItem:-1,selectedPos:{},isDrag:!1,dragPos:{},isScale:!1,scalePos:{},cursor:"auto",screenWidth:document.body.clientWidth,isbn:"",screenChange:!1,timer:!1,currentTablePage:1,tempTable:[],totalSize:0}},computed:{canvasWidth:function(){var t=.75*this.screenWidth;return this.screenChange=!0,t},canvasHeight:function(){var t=.5625*this.canvasWidth;return t},sidebarWidthLeft:function(){return.1*this.screenWidth},sidebarWidthRight:function(){return.12*this.screenWidth},width:function(){return this.canvasWidth},height:function(){return this.canvasHeight}},mounted:function(){var t=this;window.onresize=function(){return function(){t.screenWidth=document.body.clientWidth}()},this.axios.get("/book/bookList").then((function(e){if(0==e.data["code"])return localStorage.removeItem("username"),t.$message.error(e.data["result"]),void t.$router.push("/login");t.tableData=e.data["bookList"];for(var i=0;i<10;i++)t.tableData[i]&&t.tempTable.push(t.tableData[i]);t.totalSize=t.tableData.length})).catch((function(e){t.$message.error("未能获取到书籍列表，请刷新重试")}))},watch:{screenWidth:function(t){if(this.timer){this.screenWidth=t,this.timer=!1;var e=this;setTimeout((function(){e.timer=!0}),300)}}},methods:{handleEdit:function(t,e){this.idx=t,this.currentBook=e,this.editVisible=!0,this.currentPage=0;var i=this,a={isbn:i.currentBook.isbn};i.axios.get("/book/getPhoto",{params:a}).then((function(t){if(0==t.data["code"])return localStorage.removeItem("username"),i.$message.error(t.data["result"]),void i.$router.push("/login");i.imgList=t.data,i.imgList.forEach((function(t){t.src="api2/"+t.src})),console.log(i.imgList),i.currentUrl=i.imgList[0].src;document.getElementById("canvasDiv");i.ctx=document.getElementById("mainCanvas"),i.context=i.ctx.getContext("2d"),i.context.lineWidth=i.lineWidth,i.context.strokeStyle=i.lineColor;var e={isbn:i.currentBook.isbn,page:i.currentPage};i.axios.get("/resource/Area",{params:e}).then((function(t){if(0==t.data["code"])return localStorage.removeItem("username"),i.$message.error(t.data["result"]),void i.$router.push("/login");i.drawInfo=t.data["areas"],i.drawInfo.forEach((function(t){t.x=t.relativeX*i.canvasWidth,t.y=t.relativeY*i.canvasHeight,t.w=t.relativeW*i.canvasWidth,t.h=t.relativeH*i.canvasHeight})),i.rePaint()})).catch((function(t){i.$message.error("获取失败，请稍后重试")}))})).catch((function(){}));var s=new Image;s.src="https://s2.ax1x.com/2019/11/14/MtY74J.jpg",s.onload=function(){}},saveEdit:function(t){var e=this;this.$refs[t].validate((function(t){t?(e.$message.success("修改成功"),e.editVisible=!1):e.$message.error("修改有误")}))},handleUpload:function(t,e){this.uploadVisible=!0},submitUpload:function(){this.uploadVisible=!1,this.fileList=[],this.$message.success("上传成功")},clickImage:function(t){var e=this;t!==this.currentPage&&this.$confirm("切换图片前是否保存已经绘制的数据","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var i=e;e.submitMarks(),e.currentPage=t,e.currentUrl=i.imgList[t].src,e.drawInfo=[],e.selectedItem=-1;var a={isbn:e.currentBook.isbn,page:e.currentPage};e.axios.get("/resource/Area",{params:a}).then((function(t){if(0==t.data["code"])return localStorage.removeItem("username"),i.$message.error(t.data["result"]),void i.$router.push("/login");i.drawInfo=t.data["areas"],i.drawInfo.forEach((function(t){t.x=t.relativeX*i.canvasWidth,t.y=t.relativeY*i.canvasHeight,t.w=t.relativeW*i.canvasWidth,t.h=t.relativeH*i.canvasHeight})),i.rePaint()})).catch((function(t){i.$message.error("查询出错，请稍后重试")}))})).catch((function(){var i=e;e.currentPage=t,e.currentUrl=e.imgList[t].src,e.drawInfo=[],e.selectedItem=-1;var a={isbn:e.currentBook.isbn,page:e.currentPage};e.axios.get("/resource/Area",{params:a}).then((function(t){if(0==t.data["code"])return localStorage.removeItem("username"),i.$message.error(t.data["result"]),void i.$router.push("/login");i.drawInfo=t.data["areas"],i.drawInfo.forEach((function(t){t.x=t.relativeX*i.canvasWidth,t.y=t.relativeY*i.canvasHeight,t.w=t.relativeW*i.canvasWidth,t.h=t.relativeH*i.canvasHeight})),i.rePaint()})).catch((function(t){i.$message.error("查询出错，请稍后重试")}))}))},canvasUp:function(t){var e=t.clientX-t.target.parentNode.offsetLeft,i=t.clientY-t.target.parentNode.offsetTop,a=this;if(this.context.clearRect(0,0,this.width,this.height),this.isClick){0==this.drawInfo[this.drawInfo.length-1].w&&(this.selectedItem==this.drawInfo.length-1&&(this.selectedItem=-1),this.drawInfo.pop());var s=!1;this.drawInfo.forEach((function(t,n){a.context.beginPath(),a.context.rect(t.x,t.y,t.w,t.h),!s&&a.context.isPointInPath(e,i)?(s=!0,a.selectedItem=n,a.selectedPos.x=e,a.selectedPos.y=i,a.context.strokeStyle=a.selectedLineColor,a.context.fillStyle=a.selectFillColor):(a.context.strokeStyle=a.lineColor,a.context.fillStyle=a.fillColor),a.context.stroke(),a.context.fill()})),this.beginRec.imageData=this.context.getImageData(0,0,this.width,this.height),s||(this.selectedItem=-1)}else if(this.isScale){var n=this.drawInfo[this.selectedItem];n.w=e-n.x,n.h=i-n.y,n.w<0&&(n.x=n.x+n.w,n.w=Math.abs(n.w)),n.h<0&&(n.y=n.y+n.h,n.h=Math.abs(n.h)),n.relativeX=n.x/this.canvasWidth,n.relativeY=n.y/this.canvasHeight,n.relativeW=n.w/this.canvasWidth,n.relativeH=n.h/this.canvasHeight}else if(this.isDrag){var r=this.drawInfo[this.selectedItem];r.x=e-this.dragPos.x,r.y=i-this.dragPos.y,r.relativeX=r.x/this.canvasWidth,r.relativeY=r.y/this.canvasHeight}else{var o=this.drawInfo[this.drawInfo.length-1];if(this.drawInfo.length>0)if(Math.abs(o.w*o.h)<=400)this.selectedItem==this.drawInfo.length-1&&(this.selectedItem=-1),this.drawInfo.pop();else{o.w<0&&(o.x=o.x+o.w,o.w=Math.abs(o.w)),o.h<0&&(o.y=o.y+o.h,o.h=Math.abs(o.h));var c=Math.random().toString(36).slice(-8);o.uuid=c,o.relativeX=o.x/this.canvasWidth,o.relativeY=o.y/this.canvasHeight,o.relativeW=o.w/this.canvasWidth,o.relativeH=o.h/this.canvasHeight}}this.drawInfo.forEach((function(t,e){a.context.beginPath(),a.context.rect(t.x,t.y,t.w,t.h),e===a.selectedItem?(a.context.strokeStyle=a.selectedLineColor,a.context.fillStyle=a.selectFillColor):(a.context.strokeStyle=a.lineColor,a.context.fillStyle=a.fillColor),a.context.stroke(),a.context.fill()})),this.beginRec.imageData=this.context.getImageData(0,0,this.width,this.height),this.canDraw&&(this.canvasMoveUse=!1,this.isDrag=!1,this.isClick=!1,this.isScale=!1)},canvasDown:function(t){if(1==t.buttons){if(this.screenChange){var e=this;this.drawInfo.forEach((function(t){t.x=t.relativeX*e.canvasWidth,t.y=t.relativeY*e.canvasHeight,t.h=t.relativeH*e.canvasHeight,t.w=t.relativeW*e.canvasWidth})),this.rePaint(),this.screenChange=!1}var i=t.clientX-t.target.parentNode.offsetLeft,a=t.clientY-t.target.parentNode.offsetTop;if(this.isClick=!0,this.canDraw)if(-1!==this.selectedItem){var s=this.drawInfo[this.selectedItem];if(this.context.rect(s.x,s.y,s.w,s.h),this.canvasMoveUse=!0,this.context.isPointInPath(i,a)){var n=s.x+s.w,r=s.y+s.h;i>=n-20&&i<=n&&a>=r-20&&a<=r?(this.isScale=!0,this.scalePos.x1=s.x,this.scalePos.y1=s.y):(this.isDrag=!0,this.dragPos.x=i-s.x,this.dragPos.y=a-s.y,this.dragPos.w=s.w,this.dragPos.h=s.h)}else this.beginRec.x=i,this.beginRec.y=a,this.selectedPos.x=i,this.selectedPos.y=a,this.beginRec.imageData=this.context.getImageData(0,0,this.width,this.height),this.drawInfo.push({x:i,y:a,w:0,name:"区域"+this.drawInfo.length.toString(),type:this.lineType})}else this.canvasMoveUse=!0,this.beginRec.x=i,this.beginRec.y=a,this.beginRec.w=0,this.selectedPos.x=i,this.selectedPos.y=a,this.beginRec.imageData=this.context.getImageData(0,0,this.width,this.height),this.drawInfo.push({x:i,y:a,w:0,name:"区域"+(this.drawInfo.length+1).toString(),type:this.lineType})}},canvasMove:function(t){var e=t.clientX-t.target.parentNode.offsetLeft,i=t.clientY-t.target.parentNode.offsetTop;if(this.canvasMoveUse)if(this.isClick=!1,this.isScale)this.context.putImageData(this.beginRec.imageData,0,0),this.context.beginPath(),this.context.rect(this.scalePos.x1,this.scalePos.y1,e-this.scalePos.x1,i-this.scalePos.y1),this.context.strokeStyle=this.selectedLineColor,this.context.fillStyle=this.selectFillColor,this.context.stroke(),this.context.fill();else if(this.isDrag)this.context.putImageData(this.beginRec.imageData,0,0),this.context.beginPath(),this.context.rect(e-this.dragPos.x,i-this.dragPos.y,this.dragPos.w,this.dragPos.h),this.context.strokeStyle=this.selectedLineColor,this.context.fillStyle=this.selectFillColor,this.context.stroke(),this.context.fill();else{if("rec"===this.lineType){this.context.putImageData(this.beginRec.imageData,0,0),this.context.beginPath(),this.context.rect(this.beginRec.x,this.beginRec.y,e-this.beginRec.x,i-this.beginRec.y);var a=this.drawInfo[this.drawInfo.length-1];a.w=e-this.beginRec.x,a.h=i-this.beginRec.y,this.context.strokeStyle=this.selectedLineColor,this.context.fillStyle=this.selectFillColor}this.context.stroke(),this.context.fill(),this.selectedItem=this.drawInfo.length-1}else{var s=!0;if(-1!==this.selectedItem){var n=this.drawInfo[this.selectedItem],r=n.x+n.w,o=n.y+n.h;e>=r-20&&e<=r&&i>=o-20&&i<=o&&(this.cursor="se-resize",s=!1)}if(s){var c=this;this.drawInfo.forEach((function(t){e>=t.x&&e<=t.x+t.w&&i>=t.y&&i<=t.y+t.h&&(c.cursor="pointer",s=!1)}))}s&&(this.cursor="auto")}},rePaint:function(){this.context.clearRect(0,0,this.width,this.height);var t=this;this.drawInfo.forEach((function(e,i){t.context.beginPath(),t.context.rect(e.x,e.y,e.w,e.h),i===t.selectedItem?(t.context.strokeStyle=t.selectedLineColor,t.context.fillStyle=t.selectFillColor):(t.context.strokeStyle=t.lineColor,t.context.fillStyle=t.fillColor),t.context.stroke(),t.context.fill()})),this.beginRec.imageData=this.context.getImageData(0,0,this.width,this.height)},selectItem:function(t){this.selectedItem=t,this.rePaint()},updateInput:function(){this.$forceUpdate()},deleteInfo:function(t){var e=this;this.$confirm("是否确定删除第"+(t+1)+"项？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.drawInfo.splice(t,1),e.selectedItem>t?e.selectedItem--:e.selectedItem===t&&(e.selectedItem=-1),e.rePaint()})).catch((function(){e.$message.info("已取消删除")}))},submitMarks:function(){var t=this,e={isbn:this.currentBook.isbn,page:this.currentPage,markAreas:this.drawInfo};this.axios.post("/resource/Area",e).then((function(e){-1===e.data["code"]?t.$message.error(e.data["result"]):0==e.data["code"]?(localStorage.removeItem("username"),t.$message.error(e.data["result"]),t.$router.push("/login")):t.$message.success(e.data["result"])})).catch((function(e){t.$message.error("出错了，请稍后重试")}))},areaDivClose:function(t){var e=this;this.$confirm("关闭前是否要保存未保存的信息","提示",{confirmButtonText:"那先保存吧",cancelButtonText:"我不保存了",type:"warning"}).then((function(){e.submitMarks(),e.selectedItem=-1,e.canDraw&&(e.canvasMoveUse=!1,e.isDrag=!1,e.isClick=!1,e.isScale=!1),e.drawInfo=[],t()})).catch((function(){e.selectedItem=-1,e.canDraw&&(e.canvasMoveUse=!1,e.isDrag=!1,e.isClick=!1,e.isScale=!1),e.drawInfo=[],t()}))},scaleDrawInfo:function(){if(this.screenChange){var t=this;this.drawInfo.forEach((function(e){e.x=e.relativeX*t.canvasWidth,e.y=e.relativeY*t.canvasHeight,e.h=e.relativeH*t.canvasHeight,e.w=e.relativeW*t.canvasWidth})),this.rePaint(),this.screenChange=!1}},handleCurrentChange:function(t){this.currentTablePage=t;var e=10*(t-1),i=10*t;for(console.log(e,"=>",i),this.tempTable=[];e<i;e++)this.tableData[e]&&this.tempTable.push(this.tableData[e])}}}),r=n,o=(i("071b"),i("2877")),c=Object(o["a"])(r,a,s,!1,null,"4d846e3c",null);e["default"]=c.exports},"6cb5":function(t,e,i){}}]);