(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-25b76aea"],{"1e84":function(e,s,a){"use strict";a.r(s);var t=function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("div",[a("div",[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("i",{staticClass:"el-icon-user"}),e._v(" 系统管理\n            ")]),a("el-breadcrumb-item",[e._v("\n                管理员列表\n            ")])],1)],1),a("div",{staticClass:"container"},[a("el-table",{attrs:{data:e.tempList,border:"",stripe:""}},[a("el-table-column",{attrs:{prop:"username",label:"用户名"}}),a("el-table-column",{attrs:{prop:"type",label:"用户类型"}}),a("el-table-column",{attrs:{prop:"last_login",label:"上次登录时间"}}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(s){return[a("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(a){return e.changePasswd(s.row)}}},[e._v("修改密码")]),a("el-button",{attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(a){return e.deleteUser(s.$index,s.row)}}},[e._v("删除")])]}}])})],1),a("div",{staticStyle:{"text-align":"right"}},[a("el-button",{attrs:{type:"text",icon:"el-icon-plus"},on:{click:function(s){return e.addUser()}}},[e._v("添加用户")])],1),a("div",{attrs:{id:"pagination"}},[a("el-pagination",{attrs:{"current-page":e.currentTablePage,total:e.totalSize,layout:"total , ->, prev, pager, next, jumper"},on:{"current-change":e.handleCurrentChange}})],1)],1),a("el-dialog",{attrs:{title:"修改密码",visible:e.passwdVisible},on:{"update:visible":function(s){e.passwdVisible=s},close:function(s){e.passwdVisible=!1}}},[a("el-form",{ref:"changePasswdForm",attrs:{model:e.changePasswdForm,rules:e.rules}},[a("el-form-item",{attrs:{label:"用户名",prop:"username"}},[a("el-input",{attrs:{disabled:""},model:{value:e.changePasswdForm.username,callback:function(s){e.$set(e.changePasswdForm,"username",s)},expression:"changePasswdForm.username"}})],1),a("el-form-item",{attrs:{label:"输入新密码",prop:"newPass"}},[a("el-input",{attrs:{"aria-placeholder":"请输入密码","show-password":""},model:{value:e.changePasswdForm.newPass,callback:function(s){e.$set(e.changePasswdForm,"newPass",s)},expression:"changePasswdForm.newPass"}})],1),a("el-form-item",{attrs:{label:"请重新输入密码",prop:"newPass2"}},[a("el-input",{attrs:{"aria-placeholder":"请重新输入密码","show-password":""},model:{value:e.changePasswdForm.newPass2,callback:function(s){e.$set(e.changePasswdForm,"newPass2",s)},expression:"changePasswdForm.newPass2"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(s){e.passwdVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(s){return e.savePasswd()}}},[e._v("确 定")])],1)],1),a("el-dialog",{attrs:{title:"添加用户",visible:e.addUserVisible},on:{"update:visible":function(s){e.addUserVisible=s},close:function(s){e.addUserVisible=!1}}},[a("el-form",{ref:"addUserForm",attrs:{model:e.addUserForm,rules:e.rules}},[a("el-form-item",{attrs:{label:"用户名",prop:"username"}},[a("el-input",{attrs:{"aria-placeholder":"请输入用户名"},model:{value:e.addUserForm.username,callback:function(s){e.$set(e.addUserForm,"username",s)},expression:"addUserForm.username"}})],1),a("el-form-item",{attrs:{label:"用户类型",prop:"type"}},[a("el-select",{model:{value:e.addUserForm.type,callback:function(s){e.$set(e.addUserForm,"type",s)},expression:"addUserForm.type"}},e._l(e.options,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"输入新密码",prop:"newPass"}},[a("el-input",{attrs:{"aria-placeholder":"请输入密码","show-password":""},model:{value:e.addUserForm.newPass,callback:function(s){e.$set(e.addUserForm,"newPass",s)},expression:"addUserForm.newPass"}})],1),a("el-form-item",{attrs:{label:"请重新输入密码",prop:"newPass2"}},[a("el-input",{attrs:{"aria-placeholder":"请重新输入密码","show-password":""},model:{value:e.addUserForm.newPass2,callback:function(s){e.$set(e.addUserForm,"newPass2",s)},expression:"addUserForm.newPass2"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(s){e.addUserVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(s){return e.saveUser()}}},[e._v("确 定")])],1)],1)],1)},r=[],n={name:"adminManage",data:function(){var e=this,s=function(s,a,t){e.passwdVisible?e.changePasswdForm.newPass!=a?t(new Error("密码与新密码不一致")):e.addUserVisible&&e.addUserForm.newPass!=a&&t(new Error("密码与新密码不一致")):t()};return{userList:[],tempList:[],currentTablePage:1,tempTable:[],totalSize:0,rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:15,message:"用户名需在3-15个字符之间",trigger:"blur"}],type:[{required:!0,message:"请选择用户类型",trigger:"change"}],newPass:[{required:!0,message:"请输入密码",trigger:"blur"},{pattern:/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])[a-zA-Z0-9]{8,20}$/,message:"密码安全性过低，请包含数字加大小写字母,并且在8-20位之间",trigger:"blur"}],newPass2:[{required:!0,message:"请输入第二次密码",trigger:"blur"},{validator:s,trigger:"blur"},{min:8,max:20,message:"长度需在8-20位之间",trigger:"blur"}]},passwdVisible:!1,changePasswdForm:{username:"",newPass:"",newPass2:""},addUserVisible:!1,addUserForm:{username:"",type:"normalAdmin",newPass:"",newPass2:""},options:[{label:"normalAdmin",value:"normalAdmin"}]}},mounted:function(){var e=this;this.axios.get("/auth/getUser").then((function(s){if(0==s.data["code"])localStorage.removeItem("username"),e.$message.error(s.data["result"]),e.$router.push("/login");else{e.userList=s.data;for(var a=0;a<10;a++)e.userList[a]&&e.tempList.push(e.userList[a]);e.totalSize=e.userList.length}})).catch((function(s){e.$message.error("管理员列表获取失败，请稍后重试")}))},methods:{handleCurrentChange:function(e){this.currentTablePage=e;var s=10*(e-1),a=10*e;for(console.log(s,"=>",a),this.tempList=[];s<a;s++)this.userList[s]&&this.tempList.push(this.userList[s])},changePasswd:function(e){"superAdmin"!=localStorage.getItem("type")?this.$message.info("权限不足，请使用superAdmin账号登录"):(this.passwdVisible=!0,this.changePasswdForm.username=e.username,this.changePasswdForm.newPass="",this.changePasswdForm.newPass2="")},savePasswd:function(){var e=this;this.$refs["changePasswdForm"].validate((function(s){if(s){var a=e;a.axios.post("/auth/updatePassword",e.changePasswdForm).then((function(e){0==e.data["code"]?(localStorage.removeItem("username"),a.$message.error(e.data["result"]),a.$router.push("/login")):-1==e.data["code"]?a.$message.error(e.data["result"]):1==e.data["code"]&&(a.$message.success(e.data["result"]),a.passwdVisible=!1)})).catch((function(e){a.$message.error("修改失败，请稍后重试")}))}else that.$message.error("尚有字段未填写完整")}))},addUser:function(){"superAdmin"==localStorage.getItem("type")?(this.addUserVisible=!0,this.addUserForm.username="",this.addUserForm.newPass="",this.addUserForm.newPass2=""):this.$message.info("只有superAdmin账号才能删除用户")},saveUser:function(){var e=this,s=this;this.$refs.addUserForm.validate((function(a){a?s.axios.post("/auth/register",e.addUserForm).then((function(e){0==e.data["code"]?(localStorage.removeItem("username"),s.$message.error(e.data["result"]),s.$router.push("/login")):-1==e.data["code"]?s.$message.error(e.data["result"]):1==e.data["code"]&&(s.$message.success(e.data["result"]),s.addUserVisible=!1,s.tempList.push({username:s.addUserForm["username"],type:s.addUserForm["type"]}))})).catch((function(e){s.$message.error("修改失败，请稍后重试")})):s.$message.error("尚有字段未填写完整")}))},deleteUser:function(e,s){var a=this;if(console.log(s),"superAdmin"==localStorage.getItem("type"))if(localStorage.getItem("username")!=s.username){var t=this;this.$confirm("是否确定删除此用户","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var r={username:s.username};a.axios.delete("/auth/user",{data:r}).then((function(s){0==s.data["code"]?(localStorage.removeItem("username"),t.$message.error(s.data["result"]),t.$router.push("/login")):-1==s.data["code"]?t.$message.error(s.data["result"]):1==s.data["code"]&&(t.$message.success(s.data["result"]),t.tempList.splice(e,1))})).catch((function(e){t.$message.error("删除用户失败，请稍后重试")}))})).catch((function(){}))}else this.$message.info("不能删除自己T_T");else this.$message.info("只有superAdmin账号才能删除用户")}}},o=n,i=(a("92d7"),a("2877")),l=Object(i["a"])(o,t,r,!1,null,"8ac2e262",null);s["default"]=l.exports},5993:function(e,s,a){},"92d7":function(e,s,a){"use strict";var t=a("5993"),r=a.n(t);r.a}}]);